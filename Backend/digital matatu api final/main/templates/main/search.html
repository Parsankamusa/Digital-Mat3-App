{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Digital Matatu API - Search</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'styles/search.css' %}">
    <link rel="stylesheet" href="{% static 'styles/base.css' %}">
    {% block extend_head %}{% endblock %}
</head>
<body>
{% block extend_nav %}
<header>
    <nav class="navbar">
        <a href="{% url 'main:route' %}" style="text-decoration: none;">
            <div class="logo">
                <i class="fas fa-bus"></i> Digital Matatu
            </div>
        </a>
        <ul class="nav-links">
            <li><a href="{% url 'main:route' %}#features"><i class="fas fa-star"></i> Features</a></li>
            <li><a href="{% url 'main:route' %}#contact"><i class="fas fa-envelope"></i> Contact</a></li>
            <li><a href="{% url 'main:map' %}"><i class="fas fa-map-marked-alt"></i> Maps</a></li>
        </ul>
    </nav>
</header>
{% endblock %}

{% block content %}
<div class="page-wrapper">
    <!-- Sidebar with history and information -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2><i class="fas fa-info-circle"></i> Matatu Info Hub</h2>
        </div>

        <div class="sidebar-tabs">
            <div class="tab active" data-tab="history">History</div>
            <div class="tab" data-tab="landmarks">Landmarks</div>
            <div class="tab" data-tab="tips">Travel Tips</div>
        </div>

        <div class="sidebar-content">
            <!-- History Tab -->
            <div class="tab-content active" id="history-tab">
                <div class="history-timeline">
                    <h3>Matatu History in Nairobi</h3>
                    <div class="timeline-item">
                        <div class="timeline-date">1960s</div>
                        <div class="timeline-content">
                            <h4>The Beginning</h4>
                            <p>Matatus emerged as informal transport solutions when Nairobi's population began growing rapidly after independence.</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">1973</div>
                        <div class="timeline-content">
                            <h4>Presidential Decree</h4>
                            <p>President Jomo Kenyatta legalized matatus to operate without PSV licenses, leading to rapid growth of the industry.</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">1980s</div>
                        <div class="timeline-content">
                            <h4>Cultural Icon</h4>
                            <p>Matatus became a cultural phenomenon with distinctive art, music, and style that reflected youth culture.</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">2003</div>
                        <div class="timeline-content">
                            <h4>Michuki Rules</h4>
                            <p>Transport Minister John Michuki implemented strict regulations requiring speed governors, seat belts, and uniform colors.</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">2014</div>
                        <div class="timeline-content">
                            <h4>Digital Matatu Project</h4>
                            <p>The first comprehensive mapping of Nairobi's matatu network was completed, creating the foundation for digital services.</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">Present</div>
                        <div class="timeline-content">
                            <h4>Digital Transformation</h4>
                            <p>Matatus are embracing technology with digital payment systems, route tracking apps, and online booking platforms.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Landmarks Tab -->
            <div class="tab-content" id="landmarks-tab">
                <h3>Key Nairobi CBD Landmarks</h3>

                <div class="landmark-card" id="archives">
                    <div class="landmark-image">
                        <img src="{% static 'images/kenya_archives.jpg' %}" alt="Kenya National Archives">
                    </div>
                    <div class="landmark-info">
                        <h4>Kenya National Archives</h4>
                        <p>A major matatu hub located on Moi Avenue. Many routes begin and terminate here.</p>
                        <div class="landmark-routes">
                            <span class="route-badge">Route 23</span>
                            <span class="route-badge">Route 58</span>
                            <span class="route-badge">Route 46</span>
                        </div>
                        <button class="landmark-button" data-coords="-1.2841,36.8250">View on Map</button>
                    </div>
                </div>

                <div class="landmark-card" id="manchester">
                    <div class="landmark-image">
                        <img src="{% static 'images/manchester_terminus.jpg' %}" alt="Manchester Terminus">
                    </div>
                    <div class="landmark-info">
                        <h4>Manchester Terminus</h4>
                        <p>A busy terminus serving routes to eastern Nairobi neighborhoods like Buruburu and Kayole.</p>
                        <div class="landmark-routes">
                            <span class="route-badge">Route 33</span>
                            <span class="route-badge">Route 34</span>
                            <span class="route-badge">Route 19</span>
                        </div>
                        <button class="landmark-button" data-coords="-1.2870,36.8290">View on Map</button>
                    </div>
                </div>

                <div class="landmark-card" id="odeon">
                    <div class="landmark-image">
                        <img src="{% static 'images/odeon_terminus.jpg' %}" alt="Odeon Cinema Terminus">
                    </div>
                    <div class="landmark-info">
                        <h4>Odeon Cinema Terminus</h4>
                        <p>A major terminus near the historic Odeon Cinema serving routes to western Nairobi.</p>
                        <div class="landmark-routes">
                            <span class="route-badge">Route 125</span>
                            <span class="route-badge">Route 111</span>
                            <span class="route-badge">Route 102</span>
                        </div>
                        <button class="landmark-button" data-coords="-1.2820,36.8230">View on Map</button>
                    </div>
                </div>

                <div class="landmark-card" id="ambassador">
                    <div class="landmark-image">
                        <img src="{% static 'images/ambassador.jpg' %}" alt="Ambassador Hotel Stage">
                    </div>
                    <div class="landmark-info">
                        <h4>Ambassador Hotel Stage</h4>
                        <p>A popular pickup point for matatus heading to Westlands and northern suburbs.</p>
                        <div class="landmark-routes">
                            <span class="route-badge">Route 23</span>
                            <span class="route-badge">Route 106</span>
                            <span class="route-badge">Route 48</span>
                        </div>
                        <button class="landmark-button" data-coords="-1.2810,36.8180">View on Map</button>
                    </div>
                </div>
            </div>

            <!-- Travel Tips Tab -->
            <div class="tab-content" id="tips-tab">
                <h3>Matatu Travel Tips</h3>

                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="tip-content">
                        <h4>Fare Preparation</h4>
                        <p>Have small denominations ready. Most matatus don't provide change for large bills, especially during peak hours.</p>
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="tip-content">
                        <h4>Peak Hours</h4>
                        <p>Avoid traveling between 7-9 AM and 5-7 PM if possible. Fares often increase during these times and vehicles are overcrowded.</p>
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="tip-content">
                        <h4>Digital Payments</h4>
                        <p>Many matatus now accept M-Pesa and other digital payment methods. Ask the conductor before boarding.</p>
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-hand-holding"></i>
                    </div>
                    <div class="tip-content">
                        <h4>Valuables Security</h4>
                        <p>Keep your valuables secure and within sight, especially in crowded vehicles and during entry/exit.</p>
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <div class="tip-content">
                        <h4>Route Knowledge</h4>
                        <p>Learn the major landmarks along your route. Matatus often don't follow exact routes and may deviate based on traffic.</p>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main content area -->
    <main class="main-content">
        <div class="container">
            <div class="search-bar">
                <h1><i class="fas fa-search"></i> Find Matatu Routes & Services</h1>
                <p class="search-description">Search for matatus, routes, saccos, or streets across Nairobi</p>

                <!-- Enhanced search form with filters -->
                <form class="form-inline" method="POST" action="{% url 'main:search' %}">
                    {% csrf_token %}
                    <div class="search-input-group">
                        <input class="form-control" type="search" placeholder="Enter route number, matatu name, sacco, or street..." aria-label="Search" name="search_query" required>
                        <button class="btn" type="submit"><i class="fas fa-search"></i> Search</button>
                    </div>

                    <div class="search-filters">
                        <div class="filter-group">
                            <label>Filter by:</label>
                            <select name="filter_type" class="filter-select">
                                <option value="all">All Results</option>
                                <option value="routes">Routes Only</option>
                                <option value="matatus">Matatus Only</option>
                                <option value="saccos">Saccos Only</option>
                                <option value="streets">Streets Only</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label>Sort by:</label>
                            <select name="sort_by" class="filter-select">
                                <option value="relevance">Relevance</option>
                                <option value="name_asc">Name (A-Z)</option>
                                <option value="name_desc">Name (Z-A)</option>
                                <option value="fare_low">Fare (Low to High)</option>
                                <option value="fare_high">Fare (High to Low)</option>
                            </select>
                        </div>
                    </div>
                </form>

                <!-- Quick search buttons -->
                <div class="quick-search">
                    <span>Popular searches:</span>
                    <button class="quick-search-btn" data-query="CBD to Westlands">CBD to Westlands</button>
                    <button class="quick-search-btn" data-query="Eastleigh">Eastleigh</button>
                    <button class="quick-search-btn" data-query="Route 125">Route 125</button>
                    <button class="quick-search-btn" data-query="Kayole">Kayole</button>
                </div>
            </div>

            <!-- Interactive map preview -->
            <div class="map-preview" id="searchMapPreview">
                <div class="map-overlay">
                    <h3>Nairobi Matatu Network</h3>
                    <p>Click on a result to see its location on the map</p>
                </div>
            </div>

            <div class="search-results">
                {% if error %}
                <div class="alert alert-danger" role="alert">
                    <i class="fas fa-exclamation-circle"></i> {{ error }}
                </div>
                {% endif %}

                {% if not saccos and not matatus and not routes and not streets and not error %}
                <div class="no-results">
                    <i class="fas fa-search"></i>
                    <h3>Enter a search term to find matatu information</h3>
                    <p>You can search for routes, matatus, saccos, or streets</p>

                    <!-- Trending searches -->
                    <div class="trending-searches">
                        <h4>Trending searches today:</h4>
                        <div class="trending-tags">
                            <span class="trending-tag">Rongai Route <i class="fas fa-arrow-trend-up"></i></span>
                            <span class="trending-tag">Ngong Road <i class="fas fa-arrow-trend-up"></i></span>
                            <span class="trending-tag">Eastleigh Matatus <i class="fas fa-arrow-trend-up"></i></span>
                            <span class="trending-tag">Kayole <i class="fas fa-arrow-trend-up"></i></span>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Enhanced results with more details and interactive elements -->
                {% if saccos %}
                <div class="result-section">
                    <h2><i class="fas fa-building"></i> Saccos</h2>
                    <ul class="result-list">
                        {% for sacco in saccos %}
                        <li>
                            <div class="result-card" data-type="sacco" data-id="{{ sacco.id }}">
                                <div class="result-icon">
                                    <i class="fas fa-building"></i>
                                </div>
                                <div class="result-details">
                                    <div class="result-name">{{ sacco.name }}</div>
                                    <div class="result-info">
                                        <span><i class="fas fa-bus"></i> {{ sacco.matatu_count }} Matatus</span> |
                                        <span><i class="fas fa-route"></i> {{ sacco.route_count }} Routes</span>
                                    </div>
                                    <div class="result-actions">
                                        <button class="action-btn view-routes-btn" data-sacco="{{ sacco.id }}">
                                            <i class="fas fa-route"></i> View Routes
                                        </button>
                                        <button class="action-btn view-on-map-btn" data-coords="{{ sacco.headquarters_coords }}">
                                            <i class="fas fa-map-marker-alt"></i> View on Map
                                        </button>
                                    </div>
                                </div>
                                <div class="result-rating">
                                    <div class="stars">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                        <i class="far fa-star"></i>
                                    </div>
                                    <span>3.5</span>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if matatus %}
                <div class="result-section">
                    <h2><i class="fas fa-bus"></i> Matatus</h2>
                    <ul class="result-list">
                        {% for matatu in matatus %}
                        <li>
                            <div class="result-card" data-type="matatu" data-id="{{ matatu.id }}">
                                <div class="result-icon" style="background-color: #{{ matatu.color_code|default:'1a73e8' }}">
                                    <i class="fas fa-bus"></i>
                                </div>
                                <div class="result-details">
                                    <div class="result-name">{{ matatu.name }}</div>
                                    <div class="result-info">
                                        <span><i class="fas fa-money-bill-wave"></i> Fare: KSh {{ matatu.fare }}</span> |
                                        <span><i class="fas fa-route"></i> Route: {{ matatu.route.name }}</span> |
                                        <span><i class="fas fa-building"></i> Sacco: {{ matatu.sacco.name }}</span> |
                                        <span><i class="fas fa-clock"></i> Travel Time: {{ matatu.time_it_take }}</span>
                                    </div>
                                    <div class="result-schedule">
                                        <div class="schedule-item">
                                            <span class="schedule-label">First Trip:</span>
                                            <span class="schedule-value">5:30 AM</span>
                                        </div>
                                        <div class="schedule-item">
                                            <span class="schedule-label">Last Trip:</span>
                                            <span class="schedule-value">9:00 PM</span>
                                        </div>
                                        <div class="schedule-item">
                                            <span class="schedule-label">Frequency:</span>
                                            <span class="schedule-value">Every 10-15 mins</span>
                                        </div>
                                    </div>
                                    <div class="result-actions">
                                        <button class="action-btn view-route-btn" data-route="{{ matatu.route.id }}">
                                            <i class="fas fa-map-marked-alt"></i> View Route
                                        </button>
                                        <button class="action-btn fare-calculator-btn" data-matatu="{{ matatu.id }}">
                                            <i class="fas fa-calculator"></i> Fare Calculator
                                        </button>
                                        <button class="action-btn save-btn" data-matatu="{{ matatu.id }}">
                                            <i class="far fa-bookmark"></i> Save
                                        </button>
                                    </div>
                                </div>
                                <div class="result-rating">
                                    <div class="stars">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="far fa-star"></i>
                                    </div>
                                    <span>4.0</span>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if routes %}
                <div class="result-section">
                    <h2><i class="fas fa-route"></i> Routes</h2>
                    <ul class="result-list">
                        {% for route in routes %}
                        <li>
                            <div class="result-card" data-type="route" data-id="{{ route.id }}">
                                <div class="result-icon">
                                    <i class="fas fa-route"></i>
                                </div>
                                <div class="result-details">
                                    <div class="result-name">{{ route.name }}</div>
                                    <div class="result-info">
                                        <span><i class="fas fa-money-bill-wave"></i> Fare: KSh {{ route.fare }}</span> |
                                        <span><i class="fas fa-bus"></i> Matatu: {{ route.matatu.name }}</span> |
                                        <span><i class="fas fa-building"></i> Sacco: {{ route.matatu.sacco.name }}</span>
                                    </div>
                                    <div class="route-stops">
                                        <div class="route-stops-header">
                                            <i class="fas fa-map-marker-alt"></i> Major Stops:
                                        </div>
                                        <div class="stops-list">
                                            <span class="stop">CBD</span>
                                            <i class="fas fa-arrow-right"></i>
                                            <span class="stop">Ngara</span>
                                            <i class="fas fa-arrow-right"></i>
                                            <span class="stop">Parklands</span>
                                            <i class="fas fa-arrow-right"></i>
                                            <span class="stop">Westlands</span>
                                        </div>
                                    </div>
                                    <div class="result-actions">
                                        <button class="action-btn view-on-map-btn" data-route="{{ route.id }}">
                                            <i class="fas fa-map-marked-alt"></i> View on Map
                                        </button>
                                        <button class="action-btn schedule-btn" data-route="{{ route.id }}">
                                            <i class="fas fa-clock"></i> Schedule
                                        </button>
                                        <button class="action-btn save-btn" data-route="{{ route.id }}">
                                            <i class="far fa-bookmark"></i> Save
                                        </button>
                                    </div>
                                </div>
                                <div class="result-traffic">
                                    <div class="traffic-indicator moderate">
                                        <i class="fas fa-car"></i>
                                        <span>Moderate Traffic</span>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if streets %}
                <div class="result-section">
                    <h2><i class="fas fa-road"></i> Streets</h2>
                    <ul class="result-list">
                        {% for street in streets %}
                        <li>
                            <div class="result-card" data-type="street" data-id="{{ street.id }}">
                                <div class="result-icon">
                                    <i class="fas fa-road"></i>
                                </div>
                                <div class="result-details">
                                    <div class="result-name">{{ street.name }}</div>
                                    <div class="result-info">
                                        <span><i class="fas fa-building"></i> Sacco: {{ street.sacco.name }}</span> |
                                        <span><i class="fas fa-bus"></i> Matatus: {{ street.matatu_count }}</span>
                                    </div>
                                    <div class="street-matatus">
                                        <div class="street-matatus-header">
                                            <i class="fas fa-bus"></i> Matatus on this street:
                                        </div>
                                        <div class="matatu-tags">
                                            <span class="matatu-tag">Route 23</span>
                                            <span class="matatu-tag">Route 58</span>
                                            <span class="matatu-tag">Route 46</span>
                                            <span class="matatu-tag">Route 33</span>
                                            <span class="matatu-tag">+3 more</span>
                                        </div>
                                    </div>
                                    <div class="result-actions">
                                        <button class="action-btn view-on-map-btn" data-street="{{ street.id }}">
                                            <i class="fas fa-map-marked-alt"></i> View on Map
                                        </button>
                                        <button class="action-btn matatus-btn" data-street="{{ street.id }}">
                                            <i class="fas fa-bus"></i> All Matatus
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                <!-- Pagination -->
                {% if saccos or matatus or routes or streets %}
                <div class="pagination">
                    <button class="pagination-btn" {% if not has_previous %}disabled{% endif %}>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <div class="pagination-info">
                        Page <span class="current-page">1</span> of <span class="total-pages">5</span>
                    </div>
                    <button class="pagination-btn" {% if not has_next %}disabled{% endif %}>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                {% endif %}
            </div>

            <!-- Fare Calculator Modal -->
            <div class="modal" id="fareCalculatorModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Fare Calculator</h3>
                        <button class="close-modal"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="modal-body">
                        <div class="calculator-form">
                            <div class="form-group">
                                <label>Starting Point:</label>
                                <select id="startingPoint">
                                    <option value="">Select starting point</option>
                                    <option value="cbd">CBD</option>
                                    <option value="westlands">Westlands</option>
                                    <option value="eastleigh">Eastleigh</option>
                                    <option value="kayole">Kayole</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Destination:</label>
                                <select id="destination">
                                    <option value="">Select destination</option>
                                    <option value="cbd">CBD</option>
                                    <option value="westlands">Westlands</option>
                                    <option value="eastleigh">Eastleigh</option>
                                    <option value="kayole">Kayole</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Time of Day:</label>
                                <select id="timeOfDay">
                                    <option value="normal">Normal Hours</option>
                                    <option value="peak">Peak Hours</option>
                                    <option value="night">Night (After 9PM)</option>
                                </select>
                            </div>
                            <button class="calculate-btn">Calculate Fare</button>
                        </div>
                        <div class="calculation-result">
                            <h4>Estimated Fare:</h4>
                            <div class="fare-amount">KSh <span id="fareAmount">--</span></div>
                            <div class="fare-range">Range: KSh <span id="fareMin">--</span> - KSh <span id="fareMax">--</span></div>
                            <p class="fare-note">Note: Actual fares may vary based on traffic conditions and specific matatu.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schedule Modal -->
            <div class="modal" id="scheduleModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Route Schedule</h3>
                        <button class="close-modal"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="modal-body">
                        <div class="schedule-header">
                            <h4 id="routeName">Route 23: CBD - Westlands</h4>
                            <div class="schedule-tabs">
                                <div class="schedule-tab active" data-day="weekday">Weekdays</div>
                                <div class="schedule-tab" data-day="saturday">Saturday</div>
                                <div class="schedule-tab" data-day="sunday">Sunday</div>
                            </div>
                        </div>
                        <div class="schedule-content">
                            <table class="schedule-table">
                                <thead>
                                <tr>
                                    <th>Time Period</th>
                                    <th>Frequency</th>
                                    <th>Fare (KSh)</th>
                                    <th>First Trip</th>
                                    <th>Last Trip</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>Early Morning (5AM-7AM)</td>
                                    <td>Every 15 min</td>
                                    <td>50</td>
                                    <td>5:30 AM</td>
                                    <td>7:00 AM</td>
                                </tr>
                                <tr>
                                    <td>Morning Peak (7AM-9AM)</td>
                                    <td>Every 5 min</td>
                                    <td>80</td>
                                    <td>7:00 AM</td>
                                    <td>9:00 AM</td>
                                </tr>
                                <tr>
                                    <td>Mid-day (9AM-4PM)</td>
                                    <td>Every 10 min</td>
                                    <td>50</td>
                                    <td>9:00 AM</td>
                                    <td>4:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Evening Peak (4PM-7PM)</td>
                                    <td>Every 5 min</td>
                                    <td>80</td>
                                    <td>4:00 PM</td>
                                    <td>7:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Night (7PM-10PM)</td>
                                    <td>Every 15 min</td>
                                    <td>70</td>
                                    <td>7:00 PM</td>
                                    <td>9:00 PM</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="schedule-notes">
                            <p><i class="fas fa-info-circle"></i> Schedules may vary due to traffic conditions and other factors.</p>
                            <p><i class="fas fa-exclamation-triangle"></i> Last trip times may be earlier during rainy season or holidays.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nairobi CBD Simulation -->
            <div class="cbd-simulation">
                <h3><i class="fas fa-city"></i> Explore Nairobi CBD</h3>
                <p>Click on landmarks to see matatu routes and information</p>

                <div class="cbd-map-container">
                    <div class="cbd-map" id="cbdSimulation">
                        <!-- CBD Map will be rendered here with JavaScript -->
                        <div class="loading-overlay">
                            <div class="spinner"></div>
                            <p>Loading Nairobi CBD...</p>
                        </div>
                    </div>

                    <div class="cbd-landmarks">
                        <div class="landmark-button" data-landmark="archives">
                            <i class="fas fa-landmark"></i> Kenya Archives
                        </div>
                        <div class="landmark-button" data-landmark="manchester">
                            <i class="fas fa-bus"></i> Manchester Terminus
                        </div>
                        <div class="landmark-button" data-landmark="odeon">
                            <i class="fas fa-film"></i> Odeon Cinema
                        </div>
                        <div class="landmark-button" data-landmark="ambassador">
                            <i class="fas fa-hotel"></i> Ambassador Hotel
                        </div>
                        <div class="landmark-button" data-landmark="afya">
                            <i class="fas fa-building"></i> Afya Centre
                        </div>
                    </div>
                </div>

                <div class="landmark-info-panel" id="landmarkInfo">
                    <div class="landmark-info-header">
                        <h4 id="landmarkName">Select a landmark</h4>
                        <button class="close-info"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="landmark-info-content">
                        <div class="landmark-description" id="landmarkDescription">
                            Click on a landmark to view information about matatu routes and services available there.
                        </div>
                        <div class="landmark-matatus" id="landmarkMatatus">
                            <!-- Matatu information will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Searches and Saved Routes -->
            <div class="user-data-section">
                <div class="recent-searches">
                    <h3><i class="fas fa-history"></i> Recent Searches</h3>
                    <div class="recent-searches-list">
                        <div class="recent-search-item">
                            <div class="search-query">CBD to Westlands</div>
                            <div class="search-time">2 hours ago</div>
                            <button class="search-again-btn"><i class="fas fa-search"></i></button>
                        </div>
                        <div class="recent-search-item">
                            <div class="search-query">Route 23</div>
                            <div class="search-time">Yesterday</div>
                            <button class="search-again-btn"><i class="fas fa-search"></i></button>
                        </div>
                        <div class="recent-search-item">
                            <div class="search-query">Eastleigh Matatus</div>
                            <div class="search-time">3 days ago</div>
                            <button class="search-again-btn"><i class="fas fa-search"></i></button>
                        </div>
                    </div>
                </div>

                <div class="saved-routes">
                    <h3><i class="fas fa-bookmark"></i> Saved Routes</h3>
                    <div class="saved-routes-list">
                        <div class="saved-route-item">
                            <div class="route-name">CBD to Westlands (Route 23)</div>
                            <div class="route-actions">
                                <button class="view-route-btn"><i class="fas fa-eye"></i></button>
                                <button class="remove-saved-btn"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        <div class="saved-route-item">
                            <div class="route-name">CBD to Kayole (Route 19)</div>
                            <div class="route-actions">
                                <button class="view-route-btn"><i class="fas fa-eye"></i></button>
                                <button class="remove-saved-btn"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
{% endblock %}

<footer>
    <div class="footer-content">
        <div class="footer-sections">
            <div class="footer-section">
                <h3>Digital Matatu API</h3>
                <p>The most comprehensive matatu data platform in Kenya, providing real-time information on routes, schedules, and fares.</p>
                <div class="social-links">
                    <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>

            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links-list">
                    <li><a href="{% url 'main:route' %}">Home</a></li>
                    <li><a href="{% url 'main:map' %}">Interactive Map</a></li>
                    <li><a href="{% url 'main:route' %}#features">Features</a></li>
                    <li><a href="#">API Documentation</a></li>
                    <li><a href="#">Developer Resources</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Contact Us</h3>
                <ul class="contact-info">
                    <li><i class="fas fa-map-marker-alt"></i> Nairobi, Kenya</li>
                    <li><i class="fas fa-phone"></i> +254 700 000000</li>
                    <li><i class="fas fa-envelope"></i> info@digitalmatatu.co.ke</li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Newsletter</h3>
                <p>Subscribe to our newsletter for updates on new features and matatu information.</p>
                <form class="newsletter-form">
                    <input type="email" placeholder="Your email address" required>
                    <button type="submit"><i class="fas fa-paper-plane"></i></button>
                </form>
            </div>
        </div>

        <div class="footer-bottom">
            <div class="copyright">
                <p>&copy; 2024 Digital Matatu API. All rights reserved.</p>
            </div>
            <div class="footer-links">
                <a href="#"><i class="fas fa-shield-alt"></i> Privacy Policy</a>
                <a href="#"><i class="fas fa-file-contract"></i> Terms of Service</a>
                <a href="#"><i class="fas fa-envelope"></i> Contact Us</a>
            </div>
        </div>
    </div>
</footer>

<!-- JavaScript for interactive features -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Sidebar tabs functionality
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                tabs.forEach(t => t.classList.remove('active'));

                // Add active class to clicked tab
                this.classList.add('active');

                // Show corresponding tab content
                const tabName = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}-tab`).classList.add('active');
            });
        });

        // Quick search buttons
        const quickSearchBtns = document.querySelectorAll('.quick-search-btn');
        quickSearchBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const query = this.getAttribute('data-query');
                document.querySelector('input[name="search_query"]').value = query;
                document.querySelector('.form-inline').submit();
            });
        });

        // Initialize map preview
        const searchMapPreview = L.map('searchMapPreview').setView([-1.2864, 36.8172], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(searchMapPreview);

        // View on map buttons
        const viewOnMapBtns = document.querySelectorAll('.view-on-map-btn');
        viewOnMapBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const coords = this.getAttribute('data-coords');
                if (coords) {
                    const [lat, lng] = coords.split(',');
                    searchMapPreview.setView([parseFloat(lat), parseFloat(lng)], 15);
                    L.marker([parseFloat(lat), parseFloat(lng)]).addTo(searchMapPreview);

                    // Scroll to map
                    document.querySelector('.map-preview').scrollIntoView({ behavior: 'smooth' });

                    // Remove overlay
                    document.querySelector('.map-overlay').style.display = 'none';
                }
            });
        });

        // Fare calculator modal
        const fareCalculatorBtns = document.querySelectorAll('.fare-calculator-btn');
        const fareCalculatorModal = document.getElementById('fareCalculatorModal');
        const closeModalBtns = document.querySelectorAll('.close-modal');

        fareCalculatorBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                fareCalculatorModal.classList.add('show');
            });
        });

        closeModalBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                fareCalculatorModal.classList.remove('show');
                document.getElementById('scheduleModal').classList.remove('show');
            });
        });

        // Calculate fare
        const calculateBtn = document.querySelector('.calculate-btn');
        calculateBtn.addEventListener('click', function() {
            const startingPoint = document.getElementById('startingPoint').value;
            const destination = document.getElementById('destination').value;
            const timeOfDay = document.getElementById('timeOfDay').value;

            if (startingPoint && destination) {
                let baseFare = 50;

                // Simple fare calculation logic
                if (timeOfDay === 'peak') {
                    baseFare = 80;
                } else if (timeOfDay === 'night') {
                    baseFare = 70;
                }

                document.getElementById('fareAmount').textContent = baseFare;
                document.getElementById('fareMin').textContent = baseFare - 10;
                document.getElementById('fareMax').textContent = baseFare + 10;
            }
        });

        // Schedule modal
        const scheduleBtns = document.querySelectorAll('.schedule-btn');
        const scheduleModal = document.getElementById('scheduleModal');

        scheduleBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                scheduleModal.classList.add('show');
            });
        });

        // Schedule tabs
        const scheduleTabs = document.querySelectorAll('.schedule-tab');
        scheduleTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                scheduleTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                // In a real app, you would load different schedule data here
                // For this example, we'll just show the same data
            });
        });

        // Initialize CBD simulation
        const cbdSimulation = L.map('cbdSimulation').setView([-1.2864, 36.8172], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(cbdSimulation);

        // Remove loading overlay
        setTimeout(() => {
            document.querySelector('.loading-overlay').style.display = 'none';
        }, 1000);

        // CBD landmarks
        const landmarks = {
            archives: {
                name: "Kenya National Archives",
                coords: [-1.2841, 36.8250],
                description: "A major matatu hub located on Moi Avenue. Many routes begin and terminate here, serving various parts of Nairobi.",
                matatus: [
                    { route: "23", destination: "Westlands", fare: "KSh 50" },
                    { route: "58", destination: "South B", fare: "KSh 70" },
                    { route: "46", destination: "Kawangware", fare: "KSh 80" }
                ]
            },
            manchester: {
                name: "Manchester Terminus",
                coords: [-1.2870, 36.8290],
                description: "A busy terminus serving routes to eastern Nairobi neighborhoods including Buruburu, Kayole, and Umoja.",
                matatus: [
                    { route: "33", destination: "Buruburu", fare: "KSh 50" },
                    { route: "34", destination: "Umoja", fare: "KSh 60" },
                    { route: "19", destination: "Kayole", fare: "KSh 70" }
                ]
            },
            odeon: {
                name: "Odeon Cinema Terminus",
                coords: [-1.2820, 36.8230],
                description: "A major terminus near the historic Odeon Cinema serving routes to western Nairobi including Kangemi and Uthiru.",
                matatus: [
                    { route: "125", destination: "Kangemi", fare: "KSh 50" },
                    { route: "111", destination: "Uthiru", fare: "KSh 70" },
                    { route: "102", destination: "Kikuyu", fare: "KSh 100" }
                ]
            },
            ambassador: {
                name: "Ambassador Hotel Stage",
                coords: [-1.2810, 36.8180],
                description: "A popular pickup point for matatus heading to Westlands, Parklands and northern suburbs.",
                matatus: [
                    { route: "23", destination: "Westlands", fare: "KSh 50" },
                    { route: "106", destination: "Parklands", fare: "KSh 60" },
                    { route: "48", destination: "Gigiri", fare: "KSh 80" }
                ]
            },
            afya: {
                name: "Afya Centre",
                coords: [-1.2850, 36.8260],
                description: "A central location with matatus serving various routes, particularly to eastern neighborhoods.",
                matatus: [
                    { route: "58", destination: "South B", fare: "KSh 70" },
                    { route: "33", destination: "Buruburu", fare: "KSh 50" },
                    { route: "7", destination: "Eastleigh", fare: "KSh 40" }
                ]
            }
        };

        // Add landmark markers to CBD simulation
        const landmarkMarkers = {};
        const landmarkIcon = L.divIcon({
            className: 'landmark-icon',
            html: '<i class="fas fa-map-marker-alt"></i>',
            iconSize: [30, 30],
            iconAnchor: [15, 30]
        });

        for (const key in landmarks) {
            const landmark = landmarks[key];
            const marker = L.marker(landmark.coords, { icon: landmarkIcon }).addTo(cbdSimulation);
            marker.bindTooltip(landmark.name);

            marker.on('click', function() {
                showLandmarkInfo(key);
            });

            landmarkMarkers[key] = marker;
        }

        // Landmark buttons
        const landmarkButtons = document.querySelectorAll('.landmark-button');
        landmarkButtons.forEach(button => {
            button.addEventListener('click', function() {
                const landmarkKey = this.getAttribute('data-landmark');
                showLandmarkInfo(landmarkKey);

                // Pan to landmark
                cbdSimulation.setView(landmarks[landmarkKey].coords, 16);
            });
        });

        // Show landmark info
        function showLandmarkInfo(landmarkKey) {
            const landmark = landmarks[landmarkKey];
            const infoPanel = document.getElementById('landmarkInfo');
            const landmarkName = document.getElementById('landmarkName');
            const landmarkDescription = document.getElementById('landmarkDescription');
            const landmarkMatatus = document.getElementById('landmarkMatatus');

            // Set info
            landmarkName.textContent = landmark.name;
            landmarkDescription.textContent = landmark.description;

            // Build matatu list
            let matatuHTML = '<h4>Available Matatus:</h4><ul class="landmark-matatu-list">';
            landmark.matatus.forEach(matatu => {
                matatuHTML += `
                    <li class="landmark-matatu-item">
                        <div class="matatu-route">Route ${matatu.route}</div>
                        <div class="matatu-details">
                            <span><i class="fas fa-map-marker-alt"></i> ${matatu.destination}</span>
                            <span><i class="fas fa-money-bill-wave"></i> ${matatu.fare}</span>
                        </div>
                        <button class="matatu-action-btn">View Details</button>
                    </li>
                `;
            });
            matatuHTML += '</ul>';

            landmarkMatatus.innerHTML = matatuHTML;

            // Show panel
            infoPanel.classList.add('active');

            // Highlight the selected landmark button
            landmarkButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-landmark') === landmarkKey) {
                    btn.classList.add('active');
                }
            });
        }

        // Close landmark info
        document.querySelector('.close-info').addEventListener('click', function() {
            document.getElementById('landmarkInfo').classList.remove('active');
            landmarkButtons.forEach(btn => btn.classList.remove('active'));
        });

        // Save buttons
        const saveBtns = document.querySelectorAll('.save-btn');
        saveBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const icon = this.querySelector('i');

                if (icon.classList.contains('far')) {
                    // Save
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    this.classList.add('saved');

                    // Show notification
                    showNotification('Item saved successfully!');
                } else {
                    // Unsave
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    this.classList.remove('saved');

                    // Show notification
                    showNotification('Item removed from saved items.');
                }
            });
        });

        // Notification function
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-check-circle"></i>
                    <span>${message}</span>
                </div>
            `;

            // Add to body
            document.body.appendChild(notification);

            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);

            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Recent search items
        const searchAgainBtns = document.querySelectorAll('.search-again-btn');
        searchAgainBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const query = this.parentElement.querySelector('.search-query').textContent;
                document.querySelector('input[name="search_query"]').value = query;
                document.querySelector('.form-inline').submit();
            });
        });

        // Saved routes
        const viewRouteBtns = document.querySelectorAll('.view-route-btn');
        viewRouteBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // In a real app, this would navigate to the route details page
                // For this example, we'll just show a notification
                showNotification('Loading route details...');
            });
        });

        const removeSavedBtns = document.querySelectorAll('.remove-saved-btn');
        removeSavedBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove the saved route item
                this.closest('.saved-route-item').remove();
                showNotification('Route removed from saved items.');
            });
        });

        // Add traffic simulation to the map
        function simulateTraffic() {
            // Create some traffic polylines
            const trafficRoutes = [
                {
                    path: [
                        [-1.2864, 36.8172],
                        [-1.2850, 36.8200],
                        [-1.2830, 36.8230]
                    ],
                    color: '#EA4335', // Red for heavy traffic
                    weight: 5
                },
                {
                    path: [
                        [-1.2864, 36.8172],
                        [-1.2880, 36.8150],
                        [-1.2900, 36.8130]
                    ],
                    color: '#FBBC05', // Yellow for moderate traffic
                    weight: 5
                },
                {
                    path: [
                        [-1.2864, 36.8172],
                        [-1.2840, 36.8150],
                        [-1.2820, 36.8130]
                    ],
                    color: '#34A853', // Green for light traffic
                    weight: 5
                }
            ];

            trafficRoutes.forEach(route => {
                L.polyline(route.path, {
                    color: route.color,
                    weight: route.weight,
                    opacity: 0.7
                }).addTo(cbdSimulation);
            });
        }

        // Run traffic simulation
        simulateTraffic();

        // Add animated matatus to the map
        function addAnimatedMatatus() {
            // Define matatu routes for animation
            const matatuRoutes = [
                {
                    path: [
                        [-1.2864, 36.8172],
                        [-1.2850, 36.8200],
                        [-1.2830, 36.8230],
                        [-1.2810, 36.8260]
                    ],
                    duration: 10000, // 10 seconds for full route
                    color: '#4285F4',
                    routeNumber: '23'
                },
                {
                    path: [
                        [-1.2900, 36.8130],
                        [-1.2880, 36.8150],
                        [-1.2864, 36.8172],
                        [-1.2840, 36.8190]
                    ],
                    duration: 12000, // 12 seconds for full route
                    color: '#EA4335',
                    routeNumber: '58'
                },
                {
                    path: [
                        [-1.2820, 36.8130],
                        [-1.2840, 36.8150],
                        [-1.2864, 36.8172],
                        [-1.2880, 36.8190]
                    ],
                    duration: 8000, // 8 seconds for full route
                    color: '#34A853',
                    routeNumber: '33'
                }
            ];

            // Create matatu icon
            const matatuIcon = (color, routeNumber) => L.divIcon({
                className: 'matatu-icon',
                html: `<div style="background-color: ${color}; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-size: 10px; font-weight: bold;">${routeNumber}</div>`,
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });

            // Animate each matatu
            matatuRoutes.forEach(route => {
                // Add route line
                const routeLine = L.polyline(route.path, {
                    color: route.color,
                    weight: 3,
                    opacity: 0.6
                }).addTo(cbdSimulation);

                // Create matatu marker
                const matatu = L.marker(route.path[0], {
                    icon: matatuIcon(route.color, route.routeNumber)
                }).addTo(cbdSimulation);

                // Animate matatu along the route
                animateMarker(matatu, route.path, route.duration);
            });
        }

        // Function to animate marker along a path
        function animateMarker(marker, path, duration) {
            let step = 0;
            const numSteps = 100;
            const timePerStep = duration / numSteps;
            const segments = path.length - 1;
            const stepsPerSegment = numSteps / segments;

            function animate() {
                // Calculate current segment and progress within segment
                const segmentIndex = Math.min(Math.floor(step / stepsPerSegment), segments - 1);
                const segmentProgress = (step % stepsPerSegment) / stepsPerSegment;

                // Get start and end points of current segment
                const start = path[segmentIndex];
                const end = path[segmentIndex + 1];

                // Interpolate position
                const lat = start[0] + (end[0] - start[0]) * segmentProgress;
                const lng = start[1] + (end[1] - start[1]) * segmentProgress;

                // Update marker position
                marker.setLatLng([lat, lng]);

                // Continue animation if not at end
                step++;
                if (step < numSteps) {
                    setTimeout(animate, timePerStep);
                } else {
                    // Restart animation from beginning
                    step = 0;
                    setTimeout(animate, timePerStep);
                }
            }

            // Start animation
            animate();
        }

        // Add animated matatus
        addAnimatedMatatus();
    });
</script>
